<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>House Pricing Project – My sparse website</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<meta name="shinylive:serviceworker_dir" content="../..">
<script src="../../site_libs/quarto-contrib/shinylive-0.9.1/shinylive/load-shinylive-sw.js" type="module"></script>
<script src="../../site_libs/quarto-contrib/shinylive-0.9.1/shinylive/run-python-blocks.js" type="module"></script>
<link href="../../site_libs/quarto-contrib/shinylive-0.9.1/shinylive/shinylive.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/shinylive-quarto-css/shinylive-quarto.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">My sparse website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../applications.html"> 
<span class="menu-text">Applications</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#metric" id="toc-metric" class="nav-link active" data-scroll-target="#metric">Metric</a></li>
  <li><a href="#data-explorations-datacleaning." id="toc-data-explorations-datacleaning." class="nav-link" data-scroll-target="#data-explorations-datacleaning.">Data explorations data/cleaning.</a>
  <ul class="collapse">
  <li><a href="#comments-on-available-data" id="toc-comments-on-available-data" class="nav-link" data-scroll-target="#comments-on-available-data">Comments on Available Data</a></li>
  <li><a href="#data-cleaning-and-exploration" id="toc-data-cleaning-and-exploration" class="nav-link" data-scroll-target="#data-cleaning-and-exploration">Data cleaning and exploration</a></li>
  <li><a href="#recoding-na" id="toc-recoding-na" class="nav-link" data-scroll-target="#recoding-na">Recoding NA</a></li>
  <li><a href="#examining-missing-values" id="toc-examining-missing-values" class="nav-link" data-scroll-target="#examining-missing-values">Examining Missing Values</a></li>
  </ul></li>
  <li><a href="#looking-at-the-data" id="toc-looking-at-the-data" class="nav-link" data-scroll-target="#looking-at-the-data">Looking at the Data</a>
  <ul class="collapse">
  <li><a href="#recoding-of-variables" id="toc-recoding-of-variables" class="nav-link" data-scroll-target="#recoding-of-variables">Recoding of Variables</a></li>
  </ul></li>
  <li><a href="#view-varibels" id="toc-view-varibels" class="nav-link" data-scroll-target="#view-varibels">View varibels</a>
  <ul class="collapse">
  <li><a href="#feature-transformations" id="toc-feature-transformations" class="nav-link" data-scroll-target="#feature-transformations">Feature transformations</a></li>
  <li><a href="#remove-varibels" id="toc-remove-varibels" class="nav-link" data-scroll-target="#remove-varibels">Remove varibels</a></li>
  <li><a href="#variables-after-cleanup" id="toc-variables-after-cleanup" class="nav-link" data-scroll-target="#variables-after-cleanup">Variables After Cleanup</a></li>
  <li><a href="#looking-into-cross-correlation" id="toc-looking-into-cross-correlation" class="nav-link" data-scroll-target="#looking-into-cross-correlation">Looking Into Cross-Correlation</a></li>
  <li><a href="#reducing-variables-based-on-multicollinearity" id="toc-reducing-variables-based-on-multicollinearity" class="nav-link" data-scroll-target="#reducing-variables-based-on-multicollinearity">Reducing Variables Based on Multicollinearity</a></li>
  <li><a href="#overview-of-variables-with-the-highest-correlation-to-log-of-sale-price" id="toc-overview-of-variables-with-the-highest-correlation-to-log-of-sale-price" class="nav-link" data-scroll-target="#overview-of-variables-with-the-highest-correlation-to-log-of-sale-price">Overview of Variables with the Highest Correlation to Log of Sale Price</a></li>
  <li><a href="#overallqual" id="toc-overallqual" class="nav-link" data-scroll-target="#overallqual">OverallQual</a></li>
  <li><a href="#ground-lvving-area" id="toc-ground-lvving-area" class="nav-link" data-scroll-target="#ground-lvving-area">Ground lvving area</a></li>
  <li><a href="#looking-at-some-no-numeric-varibels" id="toc-looking-at-some-no-numeric-varibels" class="nav-link" data-scroll-target="#looking-at-some-no-numeric-varibels">Looking at some no numeric varibels</a></li>
  </ul></li>
  <li><a href="#models" id="toc-models" class="nav-link" data-scroll-target="#models">Models</a>
  <ul class="collapse">
  <li><a href="#base-line-mocel" id="toc-base-line-mocel" class="nav-link" data-scroll-target="#base-line-mocel">Base line mocel</a></li>
  <li><a href="#a-linear-interaction-model." id="toc-a-linear-interaction-model." class="nav-link" data-scroll-target="#a-linear-interaction-model.">A linear interaction model.</a></li>
  </ul></li>
  <li><a href="#advances-model" id="toc-advances-model" class="nav-link" data-scroll-target="#advances-model">Advances model</a>
  <ul class="collapse">
  <li><a href="#lasso" id="toc-lasso" class="nav-link" data-scroll-target="#lasso">Lasso</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost">XGBoost</a></li>
  </ul></li>
  <li><a href="#getting-ready-for-predition" id="toc-getting-ready-for-predition" class="nav-link" data-scroll-target="#getting-ready-for-predition">Getting ready for predition</a>
  <ul class="collapse">
  <li><a href="#prepration-of-test-set." id="toc-prepration-of-test-set." class="nav-link" data-scroll-target="#prepration-of-test-set.">Prepration of test set.</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">House Pricing Project</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This is practics case based on some data from <a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/overview">kaggle</a></p>
<p>I mostly made this to play around with some data and learn new methods. When working with data, like many others, I like to use either R Markdown or Jupyter Notebook. I also enjoy writing small notes and comments so that if I need to revisit the project later, I can easily see what I did. This approach is really helpful in terms of reproducibility. Unfortunately, people often share notebooks without adding any text or comments.</p>
<p>While I’ve written out some comments here, I don’t go too deep. However, I do show parts of my workflow. The code is written in R, and I consider it what I call “one-time code.” It’s not meant to be read by others, so there aren’t a lot of comments. It’s not optimized either—I’ve simply chosen the fastest code I could think of or find to solve a problem. I ende op using Chat-gbt for some code aswell then correcting the mistakes. The methology and the models chosen is all me.</p>
<section id="metric" class="level1">
<h1>Metric</h1>
<p>The goal is to achieve the lowest score on the out-of-sample prediction set based on a specific metric.</p>
<p>Let <span class="math inline">\(P_{id}\)</span> represent the price of a given house identified by <span class="math inline">\(id\)</span>.<br>
The metric used for scoring is the Root Mean Squared Deviation (RMSD) of logarithmic prices:</p>
<p><span class="math display">\[RMSD(\log(\hat{P}_{id})) = \sqrt{\frac{\sum_{id} (\log(P_{id}) - \log(\hat{P}_{id}))^2}{N}}\]</span></p>
<p>The logarithm is applied to ensure that expensive houses are not prioritized disproportionately. Without this adjustment, the model might prioritize expensive houses because the same proportional change in price would result in a larger numerical difference for higher-priced properties.</p>
<p>(While this argument makes sense, it seems like the ratio of expensive to “cheap” houses in the dataset might also affect this outcome.)<br>
(Nevertheless, this is the metric used by all other candidates, so if I want to compare my score with theirs, I must use it.)</p>
<p>When conducting the analysis, the square root is typically omitted. This simplification does not affect the results, as the square root is a monotonically increasing function. Therefore, for model selection, the choice remains unaffected.</p>
</section>
<section id="data-explorations-datacleaning." class="level1">
<h1>Data explorations data/cleaning.</h1>
<p>Their is detail data description <a href="https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/data">here</a>, on krangler af in textfile with the data.</p>
<p>I have copied the description of the covariates.</p>
<details>
<summary>
Click to expand/collapse varibel descriptions
</summary>
<ul>
<li>SalePrice - the property’s sale price in dollars. This is the target variable that you’re trying to</li>
</ul>
<p>Predictor varibels</p>
<ul>
<li>MSSubClass: The building class</li>
<li>MSZoning: The general zoning classification</li>
<li>LotFrontage: Linear feet of street connected to property</li>
<li>LotArea: Lot size in square feet</li>
<li>Street: Type of road access</li>
<li>Alley: Type of alley access</li>
<li>LotShape: General shape of property</li>
<li>LandContour: Flatness of the property</li>
<li>Utilities: Type of utilities available</li>
<li>LotConfig: Lot configuration</li>
<li>LandSlope: Slope of property</li>
<li>Neighborhood: Physical locations within Ames city limits</li>
<li>Condition1: Proximity to main road or railroad</li>
<li>Condition2: Proximity to main road or railroad (if a second is present)</li>
<li>BldgType: Type of dwelling</li>
<li>HouseStyle: Style of dwelling</li>
<li>OverallQual: Overall material and finish quality</li>
<li>OverallCond: Overall condition rating</li>
<li>YearBuilt: Original construction date</li>
<li>YearRemodAdd: Remodel date</li>
<li>RoofStyle: Type of roof</li>
<li>RoofMatl: Roof material</li>
<li>Exterior1st: Exterior covering on house</li>
<li>Exterior2nd: Exterior covering on house (if more than one material)</li>
<li>MasVnrType: Masonry veneer type</li>
<li>MasVnrArea: Masonry veneer area in square feet</li>
<li>ExterQual: Exterior material quality</li>
<li>ExterCond: Present condition of the material on the exterior</li>
<li>Foundation: Type of foundation</li>
<li>BsmtQual: Height of the basement</li>
<li>BsmtCond: General condition of the basement</li>
<li>BsmtExposure: Walkout or garden level basement walls</li>
<li>BsmtFinType1: Quality of basement finished area</li>
<li>BsmtFinSF1: Type 1 finished square feet</li>
<li>BsmtFinType2: Quality of second finished area (if present)</li>
<li>BsmtFinSF2: Type 2 finished square feet</li>
<li>BsmtUnfSF: Unfinished square feet of basement area</li>
<li>TotalBsmtSF: Total square feet of basement area</li>
<li>Heating: Type of heating</li>
<li>HeatingQC: Heating quality and condition</li>
<li>CentralAir: Central air conditioning</li>
<li>Electrical: Electrical system</li>
<li>1stFlrSF: First Floor square feet</li>
<li>2ndFlrSF: Second floor square feet</li>
<li>LowQualFinSF: Low quality finished square feet (all floors)</li>
<li>GrLivArea: Above grade (ground) living area square feet</li>
<li>BsmtFullBath: Basement full bathrooms</li>
<li>BsmtHalfBath: Basement half bathrooms</li>
<li>FullBath: Full bathrooms above grade</li>
<li>HalfBath: Half baths above grade</li>
<li>Bedroom: Number of bedrooms above basement level</li>
<li>Kitchen: Number of kitchens</li>
<li>KitchenQual: Kitchen quality</li>
<li>TotRmsAbvGrd: Total rooms above grade (does not include bathrooms)</li>
<li>Functional: Home functionality rating</li>
<li>Fireplaces: Number of fireplaces</li>
<li>FireplaceQu: Fireplace quality</li>
<li>GarageType: Garage location</li>
<li>GarageYrBlt: Year garage was built</li>
<li>GarageFinish: Interior finish of the garage</li>
<li>GarageCars: Size of garage in car capacity</li>
<li>GarageArea: Size of garage in square feet</li>
<li>GarageQual: Garage quality</li>
<li>GarageCond: Garage condition</li>
<li>PavedDrive: Paved driveway</li>
<li>WoodDeckSF: Wood deck area in square feet</li>
<li>OpenPorchSF: Open porch area in square feet</li>
<li>EnclosedPorch: Enclosed porch area in square feet</li>
<li>3SsnPorch: Three season porch area in square feet</li>
<li>ScreenPorch: Screen porch area in square feet</li>
<li>PoolArea: Pool area in square feet</li>
<li>PoolQC: Pool quality</li>
<li>Fence: Fence quality</li>
<li>MiscFeature: Miscellaneous feature not covered in other categories</li>
<li>MiscVal: $Value of miscellaneous feature</li>
<li>MoSold: Month Sold</li>
<li>YrSold: Year Sold</li>
<li>SaleType: Type of sale</li>
<li>SaleCondition: Condition of sale</li>
</ul>
</details>
<section id="comments-on-available-data" class="level2">
<h2 class="anchored" data-anchor-id="comments-on-available-data">Comments on Available Data</h2>
<p>All the houses are located in the Ames city area. There is information on the month and year sold. (In both the training and test sets, the years have the same values, meaning there’s no need to estimate values forward in time. This is a bit unusual—what is the purpose of the model in such a case?) Most of the data is categorical or discrete in nature. Some of the data has a natural order or rank. When examining the available data, it’s worth noting that there is no information on earlier sale prices—why is this missing? Information on “time on market” is also missing.</p>
</section>
<section id="data-cleaning-and-exploration" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning-and-exploration">Data cleaning and exploration</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"train.csv"</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#split &lt;- sample(1:nrow(df), size = 0.8 * nrow(df))</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training and testing sets</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#df &lt;- df[split, ]  # 80% of the data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test_for_choice &lt;- df[-split, ]  # other 20%</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">=</span><span class="fu">as.data.frame</span>(<span class="fu">read.csv</span>(<span class="st">"test.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="recoding-na" class="level2">
<h2 class="anchored" data-anchor-id="recoding-na">Recoding NA</h2>
<p>In the description, I noticed that some of the variables use NA as a category.</p>
<p>Varibels where NA is a catgori is listed below.</p>
<ul>
<li>Alley</li>
<li>BsmtQual</li>
<li>BsmtCond</li>
<li>BsmtExposure</li>
<li>BsmtFinType1</li>
<li>BsmtFinType2</li>
<li>FireplaceQu</li>
<li>GarageType</li>
<li>GarageFinish</li>
<li>GarageQual</li>
<li>GarageCond</li>
<li>PoolQC</li>
<li>Fence</li>
<li>MiscFeature</li>
</ul>
<p>These variables need to be recoded, as the values are not missing—they are simply in the wrong format.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#change </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>chang_to_df<span class="ot">&lt;-</span><span class="cf">function</span>(DF){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Alley<span class="ot">&lt;-</span>DF<span class="sc">$</span>Alley[<span class="fu">is.na</span>(DF<span class="sc">$</span>Alley)] <span class="ot">&lt;-</span> <span class="st">"No alley"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtQual[<span class="fu">is.na</span>(DF<span class="sc">$</span>BsmtQual)]<span class="ot">&lt;-</span><span class="st">"No Basement"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtCond[<span class="fu">is.na</span>(DF<span class="sc">$</span>BsmtCond)]<span class="ot">&lt;-</span><span class="st">"No Basement"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtExposure[<span class="fu">is.na</span>(DF<span class="sc">$</span>BsmtExposure)]<span class="ot">&lt;-</span><span class="st">"No Basement"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtFinType1[<span class="fu">is.na</span>(DF<span class="sc">$</span>BsmtFinType1)]<span class="ot">&lt;-</span> <span class="st">"No Basement"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtFinType2[<span class="fu">is.na</span>(DF<span class="sc">$</span>BsmtFinType2)]<span class="ot">&lt;-</span> <span class="st">"No Basement"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>FireplaceQu[<span class="fu">is.na</span>(DF<span class="sc">$</span>FireplaceQu)]<span class="ot">&lt;-</span><span class="st">"No Fireplace"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageType[<span class="fu">is.na</span>(DF<span class="sc">$</span>GarageType)]<span class="ot">&lt;-</span><span class="st">"No Garage"</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageFinish[<span class="fu">is.na</span>(DF<span class="sc">$</span>GarageFinish)]<span class="ot">&lt;-</span><span class="st">"No Garage"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageQual[<span class="fu">is.na</span>(DF<span class="sc">$</span>GarageQual)]<span class="ot">&lt;-</span><span class="st">"No Garage"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageCond[<span class="fu">is.na</span>(DF<span class="sc">$</span>GarageCond)]<span class="ot">&lt;-</span><span class="st">"No Garage"</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageYrBlt[<span class="fu">is.na</span>(DF<span class="sc">$</span>GarageYrBlt)]<span class="ot">&lt;-</span><span class="dv">0</span> <span class="co"># all values that is NA corespond wither other showing that their is no garage.</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>PoolQC[<span class="fu">is.na</span>(DF<span class="sc">$</span>PoolQC)]<span class="ot">&lt;-</span><span class="st">"No Pool"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Fence[<span class="fu">is.na</span>(DF<span class="sc">$</span>Fence)]<span class="ot">&lt;-</span><span class="st">"No Fence"</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>MiscFeature[<span class="fu">is.na</span>(DF<span class="sc">$</span>MiscFeature)]<span class="ot">&lt;-</span><span class="st">"None"</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(DF)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">chang_to_df</span>(df)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test_for_choice&lt;-chang_to_df(df_test_for_choice)</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">&lt;-</span><span class="fu">chang_to_df</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="examining-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="examining-missing-values">Examining Missing Values</h2>
<p>After recoding cases where NA does not represent missing values, we will now analyze the actual missing values.</p>
<p>Below is a plot showing the missing values. I had to split the plot into two parts; otherwise, the variable names would not be readable.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(df[,<span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(df[,<span class="dv">40</span><span class="sc">:</span><span class="dv">81</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>LotFrontage missing values look weird.</p>
<p>The definition is Linear feet of street connected to property. Below i have printed uniqe entreances in LotFrontage.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>((df<span class="sc">$</span>LotFrontage))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 21  24  30  32  33  34  35  36  37  38  39  40  41  42  43  44  45  46  47  48 
 23  19   6   5   1  10   9   6   5   1   1  12   6   4  12   9   3   1   5   6 
 49  50  51  52  53  54  55  56  57  58  59  60  61  62  63  64  65  66  67  68 
  4  57  15  14  10   6  17   5  12   7  13 143   8   9  17  19  44  15  12  19 
 69  70  71  72  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88 
 11  70  12  17  18  15  53  11   9  25  17  69   6  12   5   9  40  10   5  10 
 89  90  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108 
  6  23   6  10   8   6   7   8   2   8   3  16   2   4   3   3   6   1   7   3 
109 110 111 112 114 115 116 118 120 121 122 124 128 129 130 134 137 138 140 141 
  2   6   1   1   2   2   2   2   7   2   2   2   1   2   3   2   1   1   1   1 
144 149 150 152 153 160 168 174 182 313 
  1   1   1   1   1   1   1   2   1   2 </code></pre>
</div>
</div>
<p>From the definition, it could refer to farms, but there are no farms in the dataset.</p>
<p>If we plot the house types against the number of missing values, we see that most of them come from single-family detached houses.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Test farm theory</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>test_LotFrontage <span class="ot">&lt;-</span> df<span class="sc">$</span>LotFrontage</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>test_LotFrontage[<span class="fu">is.na</span>(test_LotFrontage)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>test_BldgType <span class="ot">&lt;-</span> <span class="fu">factor</span>(df<span class="sc">$</span>BldgType)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(test_BldgType, test_LotFrontage)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>zero_counts <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(test_LotFrontage <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(test_BldgType)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the bar plot with category labels at the bottom</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(zero_counts<span class="sc">$</span>n, </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">names.arg =</span> zero_counts<span class="sc">$</span>test_BldgType,  <span class="co"># Use the correct column for labels</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="st">"Number of Zeros by Category"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">"Categories"</span>,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="st">"Count of Zeros"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">col =</span> <span class="st">"lightblue"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">las =</span> <span class="dv">2</span>)  <span class="co"># Rotate labels to vertical</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It seems like most of the missing values are from single-family detached houses, so it’s unrealistic to assume there is no street connected to the property. This means setting the values to zero is likely a bad option.</p>
<p>Options for imputation:</p>
<p>Linear regression based on other variables. k-nearest neighbors. I could also disregard this variable since I doubt it has high predictive power.</p>
<p>It seems like an interactive linear model, incorporating the interaction between LotArea and LotShape, would provide good imputation (this also makes sense conceptually).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Imputasion_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(LotFrontage <span class="sc">~</span> LotArea <span class="sc">*</span> LotShape, df)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot fitted values vs. residuals</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Imputasion_model<span class="sc">$</span>fitted.values, Imputasion_model<span class="sc">$</span>residuals,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Residuals plot (LotFrontage ~ LotArea * LotShape)"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a horizontal line at the mean of the residuals (which should be zero)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fu">mean</span>(Imputasion_model<span class="sc">$</span>residuals), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>mean_value <span class="ot">&lt;-</span> <span class="fu">mean</span>(Imputasion_model<span class="sc">$</span>residuals)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> <span class="fu">max</span>(Imputasion_model<span class="sc">$</span>fitted.values), </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> mean_value, </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> <span class="st">"Mean"</span>, </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Missing values for LotFrontage will be imputed using the linear model described above.</p>
<p>This also means that if LotFrontage is used in the model, the imputation will need to be performed on the test set as well. I have internally debated whether I should include the test set when building the imputation model—essentially, creating a model based on both the training and test sets for this purpose.</p>
<p>Since I’m a little new to Kaggle, if the test set contains covariates and I only need to upload the fitted values, I would proceed with this approach. Otherwise, I would not. For now, I will just use the model based only on the training set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># imputatsion</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Imputasion_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(LotFrontage <span class="sc">~</span> LotArea <span class="sc">*</span> LotShape, df)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>Input_value<span class="ot">&lt;-</span><span class="cf">function</span>(DF){</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(DF<span class="sc">$</span>LotFrontage)){</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.na</span>(DF<span class="sc">$</span>LotFrontage[i])){</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>      DF<span class="sc">$</span>LotFrontage[i]<span class="ot">&lt;-</span>predicted_value <span class="ot">&lt;-</span> <span class="fu">predict</span>(Imputasion_model, <span class="at">newdata =</span> <span class="fu">list</span>(</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">LotArea =</span> DF<span class="sc">$</span>LotArea[i],</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">LotShape =</span> DF<span class="sc">$</span>LotShape[i] ))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(DF)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">#input df for all input values</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">Input_value</span>(df)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test_for_choice&lt;-Input_value(df_test_for_choice)</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">&lt;-</span><span class="fu">Input_value</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>There are still 1% of missing values in MasVnrArea and MasVnrType. I will discard the last row containing these missing values.</p>
</section>
</section>
<section id="looking-at-the-data" class="level1">
<h1>Looking at the Data</h1>
<p>In this section, I will examine the variable distributions and determine if any transformations or categorizations are necessary. To explore the data, I have created a number of plots for the variables. To make this process more accessible to potential readers, I have developed a small Shiny live application. To run this application live, I need to read the data from an online source, which is hosted on my GitHub page.</p>
<p>I have included the code for the plots, and a potential reader can see in the code where the data is written to a text file.</p>
<section id="recoding-of-variables" class="level2">
<h2 class="anchored" data-anchor-id="recoding-of-variables">Recoding of Variables</h2>
<p>Some of these variables have a ranking, which makes them well-suited for recoding. By recoding them as numerical values, the ranking becomes more obvious.</p>
<details>
<summary>
Click to expand/collapse varibel recoeding
</summary>
<p>To give a exampel of the recoding. PoolQC: Pool quality</p>
<pre><code>   Ex   Excellent         (4)
   Gd   Good              (3)
   TA   Average/Typical   (2)   (TA is never obsevered in pool varibel for traning set)
   Fa   Fair              (1)
   NA   No Pool           (0)</code></pre>
<p>can be codes as 0-4</p>
<p>Belowe here i have made list of how the varibels is code. I have made is so no pressent cagories NA is code to 0. Meaning 0 is only a value if the item is not pressent. and otherwise it starts from 1.</p>
<p>LotShape: General shape of property Reg Regular (4) IR1 Slightly irregular (3) IR2 Moderately Irregular (2) IR3 Irregular (1)</p>
<p>LandContour: Flatness of the property</p>
<pre><code>   Lvl  Near Flat/Level                                                     (4)
   Bnk  Banked - Quick and significant rise from street grade to building   (3)
   HLS  Hillside - Significant slope from side to side                      (2)
   Low  Depression                                                          (1)</code></pre>
<p>LandSlope: Slope of property</p>
<pre><code>   Gtl  Gentle slope    (3)
   Mod  Moderate Slope  (2)
   Sev  Severe Slope    (1)</code></pre>
<p>ExterQual: Evaluates the quality of the material on the exterior</p>
<pre><code>   Ex   Excellent       (5)
   Gd   Good            (4)
   TA   Average/Typical (3)
   Fa   Fair            (2)
   Po   Poor            (1)
   </code></pre>
<p>ExterCond: Evaluates the present condition of the material on the exterior</p>
<pre><code>   Ex   Excellent       (5)
   Gd   Good            (4)
   TA   Average/Typical (3)
   Fa   Fair            (2)
   Po   Poor            (1)
   </code></pre>
<p>BsmtQual: Evaluates the height of the basement</p>
<pre><code>   Ex   Excellent (100+ inches)   (5)
   Gd   Good (90-99 inches)       (4)
   TA   Typical (80-89 inches)    (3)
   Fa   Fair (70-79 inches)       (2)
   Po   Poor (&lt;70 inches          (1)
   NA   No Basement               (0)</code></pre>
<p>BsmtCond: Evaluates the general condition of the basement</p>
<pre><code>   Ex   Excellent                                     (5)
   Gd   Good                                          (4)
   TA   Typical - slight dampness allowed             (3)
   Fa   Fair - dampness or some cracking or settling  (2)
   Po   Poor - Severe cracking, settling, or wetness  (1)
   NA   No Basement                                   (0)</code></pre>
<p>BsmtExposure: Refers to walkout or garden level walls</p>
<pre><code>   Gd   Good Exposure                                                               (4)
   Av   Average Exposure (split levels or foyers typically score average or above)  (3) 
   Mn   Mimimum Exposure                                                            (2)
   No   No Exposure                                                                 (1)
   NA   No Basement                                                                 (0)</code></pre>
<p>BsmtFinType1: Rating of basement finished area</p>
<pre><code>   GLQ  Good Living Quarters            (6)
   ALQ  Average Living Quarters         (5)
   BLQ  Below Average Living Quarters     (4)
   Rec  Average Rec Room                (3)
   LwQ  Low Quality                     (2)
   Unf  Unfinshed                       (1)
   NA   No Basement                       (0)</code></pre>
<p>BsmtFinType2: Rating of basement finished area (if multiple types)</p>
<pre><code>   GLQ  Good Living Quarters            (6)
   ALQ  Average Living Quarters         (5)
   BLQ  Below Average Living Quarters     (4)
   Rec  Average Rec Room                (3)
   LwQ  Low Quality                     (2)
   Unf  Unfinshed                       (1)
   NA   No Basement                       (0)</code></pre>
<p>HeatingQC: Heating quality and condition</p>
<pre><code>   Ex   Excellent       (5)
   Gd   Good            (4)
   TA   Average/Typical (3)
   Fa   Fair            (2)
   Po   Poor            (1)</code></pre>
<p>KitchenQual: Kitchen quality</p>
<pre><code>   Ex   Excellent       (5)
   Gd   Good            (4)
   TA   Average/Typical (3)
   Fa   Fair            (2)
   Po   Poor            (1)</code></pre>
<p>Functional: Home functionality (Assume typical unless deductions are warranted)</p>
<pre><code>   Typ  Typical Functionality   (7)
   Min1 Minor Deductions 1      (6)
   Min2 Minor Deductions 2      (5)
   Mod  Moderate Deductions     (4)
   Maj1 Major Deductions 1      (3)
   Maj2 Major Deductions 2      (2)
   Sev  Severely Damaged        (1)
   Sal  Salvage only            (0)
   </code></pre>
<p>FireplaceQu: Fireplace quality</p>
<pre><code>   Ex   Excellent - Exceptional Masonry Fireplace                                               (5)
   Gd   Good - Masonry Fireplace in main level                                                  (4)
   TA   Average - Prefabricated Fireplace in main living area or Masonry Fireplace in basement  (3)
   Fa   Fair - Prefabricated Fireplace in basement                                              (2)
   Po   Poor - Ben Franklin Stove                                                               (1)
   NA   No Fireplace                                                                            (0)</code></pre>
<p>GarageFinish: Interior finish of the garage</p>
<pre><code>   Fin  Finished        (3)
   RFn  Rough Finished  (2) 
   Unf  Unfinished      (1)
   NA   No Garage         (0)
   </code></pre>
<p>GarageQual: Garage quality</p>
<pre><code>   Ex   Excellent         (5)
   Gd   Good              (4)
   TA   Typical/Average   (3)
   Fa   Fair              (2)
   Po   Poor              (1)
   NA   No Garage         (0)</code></pre>
<p>GarageCond: Garage condition</p>
<pre><code>   Ex   Excellent         (5)
   Gd   Good              (4)
   TA   Typical/Average   (3)
   Fa   Fair              (2)
   Po   Poor              (1)
   NA   No Garage         (0)</code></pre>
<p>PoolQC: Pool quality</p>
<pre><code>   Ex   Excellent         (4)
   Gd   Good              (3)
   TA   Average/Typical   (2)   (TA is never obsevered in pool varibel for traning set)
   Fa   Fair              (1)
   NA   No Pool           (0)
   </code></pre>
<p>Fence: Fence quality</p>
<pre><code>   GdPrv    Good Privacy    (4)
   MnPrv    Minimum Privacy (3)
   GdWo Good Wood         (2)
   MnWw Minimum Wood/Wire (1)
   NA   No Fence            (0)</code></pre>
Their properly also some rank to other varibels, varibels like building matrials must have a ranking in terms of price. But i dont have any idear about whese.
<details>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reencoding can be don via match.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># recoding</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>recoding<span class="ot">&lt;-</span><span class="cf">function</span>(DF){</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>LotShape<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>LotShape,<span class="fu">c</span>(<span class="st">"IR3"</span>,<span class="st">"IR2"</span>,<span class="st">"IR1"</span>,<span class="st">"Reg"</span>))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#DF$LandContour&lt;-match(DF$LandContour,c("Low","HLS","Bnk","Lvl"))</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#DF$LandSlope&lt;-match(DF$LandSlope,c("Sev","Mod","Gtl"))</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>ExterQual<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>ExterQual,<span class="fu">c</span>(<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>ExterCond<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>ExterCond,<span class="fu">c</span>(<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtQual<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>BsmtQual,<span class="fu">c</span>(<span class="st">"No Basement"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtCond<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>BsmtCond,<span class="fu">c</span>(<span class="st">"No Basement"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtExposure<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>BsmtExposure,<span class="fu">c</span>(<span class="st">"No Basement"</span>,<span class="st">"No"</span>,<span class="st">"Mn"</span>,<span class="st">"Av"</span>,<span class="st">"Gd"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtFinType1<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>BsmtFinType1,<span class="fu">c</span>(<span class="st">"No Basement"</span>,<span class="st">"Unf"</span>,<span class="st">"LwQ"</span>,<span class="st">"Rec"</span>,<span class="st">"BLQ"</span>,<span class="st">"ALQ"</span>,<span class="st">"GLQ"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtFinType2<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>BsmtFinType2,<span class="fu">c</span>(<span class="st">"No Basement"</span>,<span class="st">"Unf"</span>,<span class="st">"LwQ"</span>,<span class="st">"Rec"</span>,<span class="st">"BLQ"</span>,<span class="st">"ALQ"</span>,<span class="st">"GLQ"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>HeatingQC<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>HeatingQ,<span class="fu">c</span>(<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>KitchenQual<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>KitchenQual,<span class="fu">c</span>(<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Functional<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>Functional,<span class="fu">c</span>(<span class="st">"Sal"</span>,<span class="st">"Sev"</span>,<span class="st">"Maj2"</span>,<span class="st">"Maj1"</span>,<span class="st">"Mod"</span>,<span class="st">"Min2"</span>,<span class="st">"Min1"</span>,<span class="st">"Typ"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>FireplaceQu<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>FireplaceQu,<span class="fu">c</span>(<span class="st">"No Fireplace"</span>,<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageFinish<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>GarageFinish,<span class="fu">c</span>(<span class="st">"No Garage"</span>,<span class="st">"Unf"</span>,<span class="st">"RFn"</span>,<span class="st">"Fin"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageQual<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>GarageQual,<span class="fu">c</span>(<span class="st">"No Garage"</span>,<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageCond<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>GarageCond,<span class="fu">c</span>(<span class="st">"No Garage"</span>,<span class="st">"Po"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>PoolQC<span class="ot">&lt;-</span><span class="fu">match</span>(DF<span class="sc">$</span>PoolQC, <span class="fu">c</span>(<span class="st">"No Pool"</span>,<span class="st">"Fa"</span>,<span class="st">"TA"</span>,<span class="st">"Gd"</span>,<span class="st">"Ex"</span>))<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#DF$Fence&lt;-match(DF$Fence,c("No Fence","MnWw","GdWo","MnPrv","GdPrv"))-1</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(DF)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>df<span class="ot">&lt;-</span><span class="fu">recoding</span>(df)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test_for_choice&lt;-recoding(df_test_for_choice)</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">&lt;-</span><span class="fu">recoding</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</details></details></section>
</section>
<section id="view-varibels" class="level1">
<h1>View varibels</h1>
<p>Below is a plot of all the variables. I prefer histograms over boxplots as they provide a better overview of the distribution.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data_before_clean.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(df)) {</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(df[[col]])) {</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Numeriske variabler - Lav histogram</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    n_unique <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(df[[col]]))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes_string</span>(<span class="at">x =</span> col)) <span class="sc">+</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="fu">min</span>(n_unique, <span class="dv">30</span>), <span class="at">fill =</span> <span class="st">'skyblue'</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Histogram of'</span>, col), <span class="at">x =</span> col, <span class="at">y =</span> <span class="st">'Frequency'</span>) <span class="sc">+</span> </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_minimal</span>()</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ikke-numeriske variabler - Lav bar plot</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes_string</span>(<span class="at">x =</span> col)) <span class="sc">+</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">'orange'</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Bar Plot of'</span>, col), <span class="at">x =</span> col, <span class="at">y =</span> <span class="st">'Count'</span>) <span class="sc">+</span> </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_minimal</span>()</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)  <span class="co"># Vis plottet</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre class="shinylive-r" data-engine="r"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 600
library(shiny)
library(ggplot2)

data_before &lt;- read.csv("https://raw.githubusercontent.com/Missing-almost-everywhere/Missing-almost-everywhere.io/main/Projects/house-prices-advanced-regression-techniqueshouse-prices-advanced-regression-techniques-data/data_before_clean.csv")

ui &lt;- fluidPage(
  titlePanel("House Prices Data Visualization"),
  sidebarLayout(
    sidebarPanel(
      selectInput("variable", "Select Variable:", choices = names(data_before))
    ),
    mainPanel(
      plotOutput("dynamicPlot")
    )
  )
)

server &lt;- function(input, output) {
  output$dynamicPlot &lt;- renderPlot({
    col &lt;- input$variable
    
    if (is.numeric(data_before[[col]])) {
      ggplot(data_before, aes(x = .data[[col]])) + 
        geom_histogram(bins = 30, fill = 'skyblue', color = 'black', alpha = 0.7) +
        labs(title = paste('Histogram of', col), x = col, y = 'Frequency') +
        theme_minimal()
    } else {
      ggplot(data_before, aes(x = .data[[col]])) + 
        geom_bar(fill = 'orange', color = 'black', alpha = 0.7) +
        labs(title = paste('Bar Plot of', col), x = col, y = 'Count') +
        theme_minimal()
    }
  })
}

shinyApp(ui = ui, server = server)</code></pre>
<p>Notes to historigrams</p>
<ul>
<li>MSSubClass their is some cagories without alot of cases.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>counts_df_MSSubClass <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(df<span class="sc">$</span>MSSubClass))</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns for clarity</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(counts_df_MSSubClass) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"MSSubClass"</span>, <span class="st">"Count"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(counts_df_MSSubClass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   MSSubClass Count
1          20   536
2          30    69
3          40     4
4          45    12
5          50   144
6          60   299
7          70    60
8          75    16
9          80    58
10         85    20
11         90    52
12        120    87
13        160    63
14        180    10
15        190    30</code></pre>
</div>
</div>
<ul>
<li><p>Id value are unique, and should not be incluede (it could have bin the case the same house hade bin sold multipuel times).</p></li>
<li><p>KitchenAbvGr is very skewed in distribution.</p></li>
</ul>
<section id="feature-transformations" class="level2">
<h2 class="anchored" data-anchor-id="feature-transformations">Feature transformations</h2>
<p>In this section i will list the varibels i have change and what the changes was.</p>
<details>
<summary>
Click to expand/collapse varibel Changes
</summary>
<p>Looking at the description of the data the varibesl with lowe count, is</p>
<ul>
<li>40: 1-STORY W/FINISHED ATTIC ALL AGES</li>
<li>45: 1-1/2 STORY - UNFINISHED ALL AGES</li>
<li>75: 2-1/2 STORY ALL AGES</li>
<li>85: SPLIT FOYER</li>
<li>185: PUD - MULTILEVEL - INCL SPLIT LEV/FOYER</li>
</ul>
<p>Here is what i will combine them to.</p>
<p>40 will be combined with 50 - 50: 1-1/2 STORY FINISHED ALL AGES Making 1-1/2 STORY FINISHED ALL AGES</p>
<p>85 will be combined with 80 - 80: SPLIT OR MULTI-LEVEL Making Split</p>
<p>185 will be combined with 160 - 160: 2-STORY PUD - 1946 &amp; NEWER Making PUD - MULTILEVEL</p>
<p>This only leaves 45: UNFINISHED ALL AGES</p>
<p>with a vary small number of obsevations, in this section we looking at the data but this kind of asumption will affect models choice, what is the value of unfinished house, alle ages. A unfinish house can either be a cheap way to get new house ore a extra expens since it proberly should be removed. Both of these would proberly have lower value than the 1-1/2 STORY FINISHED ALL AGES. So if i inclued them i can drag down the estimat for this groups, and this can be unproporsional if the model is fitted with least sqaur. If i dont comined it with a varibel want to use a interaction effect in linear model I will get model wiht a lot NA, where this the combinations is not represented, i can get around this by tackling overide the model, so basically get to make geuss in whose case, that could be the average house price, something more cleaver, so for now i will leave it in. If i have to do the overird i will tell, this is better than a zero score. In the total linear model this is not a problem, so i may be the case this not problem.</p>
<ul>
<li><p>YearBuilt Som of this varibel is allready pressent in MSSubClass</p></li>
<li><p>GarageCars I have think about, it would give nice distribution if it was seplified belove ore equalt 2 cars with true and false. but i think their is more infomation in o zeror so the the varibel vill be zero, one, two, above 2</p></li>
</ul>
<p>Looking at this it seam like it would be a god idear to cagaorise/colabse some of these varibel. This is to try to simplify the information. The problem that can arise is that with some of these varibels, they have such ueven distribution that, one can end up fitting a combination to uniqe house. this could be good fine but, in some case by colsaping one can better overall predictiv results. Later I will proberly reduce the dimension based on either spearman ore kendall tau corelation so one would want to ensure that if their is rank in the data is preserved. To give a exampel number of fireplace can be reduces to Yes or No.&nbsp;Yes would stille be higer than No.</p>
<ul>
<li><p>fireplace siplified to binary yes and NO</p></li>
<li><p>PoolArea will be change to yes no their is not alot of information -pool yes No</p></li>
</ul>
<p>For these i could it could potensiel be a good idear to eihter make fullbath total Halfbath total. ore colabs them in to yes no</p>
<ul>
<li>Fullbath</li>
<li>Halfbath<br>
</li>
<li>bsmtFullBath</li>
<li>BsmtHalfBath</li>
<li>Fenche will be change to True ore FAlSE</li>
<li>SaleCondition will be normal True ore False</li>
<li>LandContour will be change to level ore not. I will stil count this haveing a order, meaning level wich is equal to one is prefered</li>
<li>LandSlope will be change to ground level ore not.</li>
</ul>
<p>Foundation will be combined by combin all other than “PConc” ore “CBlock” to “other”</p>
<p>LotConfig all other than Corner Inside will be combined</p>
<p>RoofStyle will be “Gable” or “other”</p>
<p>The one data point in MiscFeature that is tenis court will go under other</p>
<p>In Condition1 the following RRNe Within 200’ of East-West Railroad RRAe Adjacent to East-West Railroad RRNn Within 200’ of North-South Railroad RRAn Adjacent to North-South Railroad</p>
<p>Will be combied to (Near Railroad)</p>
<p>In the Exterior1st and Exterior2nd. Their is some catagories with single obsevations in, I will put them in the closet cagori.</p>
<details>
<p>I have rapt all the change in a function so it esay to aplly to the test dataset aswell</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>modify_df <span class="ot">&lt;-</span> <span class="cf">function</span>(DF){</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>MSSubClass[DF<span class="sc">$</span>MSSubClass <span class="sc">==</span> <span class="dv">40</span>] <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>MSSubClass[DF<span class="sc">$</span>MSSubClass <span class="sc">==</span> <span class="dv">85</span>] <span class="ot">&lt;-</span> <span class="dv">80</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>MSSubClass[DF<span class="sc">$</span>MSSubClass <span class="sc">==</span> <span class="dv">185</span>] <span class="ot">&lt;-</span> <span class="dv">160</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>have_Garage<span class="ot">&lt;-</span>DF<span class="sc">$</span>GarageCars<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageCars<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is Fireplace pressent</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Fireplaces_present<span class="ot">&lt;-</span>DF<span class="sc">$</span>Fireplaces<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Fireplaces<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>FireplaceQu<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># is pool pressent</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>pool_present<span class="ot">&lt;-</span>DF<span class="sc">$</span>PoolArea<span class="sc">&gt;</span><span class="dv">0</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>PoolArea<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Full bath pressent above ground</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>FullBath_total<span class="ot">&lt;-</span>DF<span class="sc">$</span>BsmtFullBath<span class="sc">+</span>DF<span class="sc">$</span>FullBath</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtFullBath<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>FullBath<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>HalfBath_total<span class="ot">&lt;-</span>DF<span class="sc">$</span>HalfBath<span class="sc">+</span>DF<span class="sc">$</span>BsmtHalfBath</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>HalfBath<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>BsmtHalfBath<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Alley<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Fence<span class="ot">&lt;-</span>DF<span class="sc">$</span>Fence<span class="sc">!=</span><span class="st">"No Fence"</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>SaleCondition<span class="ot">&lt;-</span>DF<span class="sc">$</span>SaleCondition<span class="sc">==</span><span class="st">"Normal"</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>LandContour<span class="ot">&lt;-</span>DF<span class="sc">$</span>LandContour<span class="sc">==</span><span class="st">"Lvl"</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>LandSlope<span class="ot">&lt;-</span>DF<span class="sc">$</span>LandSlope<span class="sc">==</span><span class="st">"Gtl"</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Foundation[<span class="sc">!</span>(DF<span class="sc">$</span>Foundation <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"PConc"</span>, <span class="st">"CBlock"</span>))] <span class="ot">&lt;-</span> <span class="st">"Other"</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>LotConfig[<span class="sc">!</span>(DF<span class="sc">$</span>LotConfig <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Corner"</span>,<span class="st">"Inside"</span>))]<span class="ot">&lt;-</span><span class="st">"Other"</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>RoofStyle<span class="ot">&lt;-</span>DF<span class="sc">$</span>RoofStyle<span class="sc">!=</span><span class="st">"Gable"</span></span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>MiscFeature[DF<span class="sc">$</span>MiscFeature<span class="sc">==</span><span class="st">"TenC"</span>]<span class="ot">&lt;-</span><span class="st">"Othr"</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Condition1[DF<span class="sc">$</span>Condition1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"RRNe"</span>,<span class="st">"RRAe"</span>,<span class="st">"RRNn"</span>,<span class="st">"RRAn"</span>)]<span class="ot">&lt;-</span><span class="st">"NR"</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Exterior1st[DF<span class="sc">$</span>Exterior1st<span class="sc">==</span><span class="st">"AsphShn"</span>]<span class="ot">&lt;-</span><span class="st">"AsbShng"</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Exterior1st[DF<span class="sc">$</span>Exterior1st<span class="sc">==</span><span class="st">"CBlock"</span>]<span class="ot">&lt;-</span><span class="st">"CemntBd"</span></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Exterior1st[DF<span class="sc">$</span>Exterior1st<span class="sc">==</span><span class="st">"ImStucc"</span>]<span class="ot">&lt;-</span><span class="st">"Stucco"</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Exterior2nd[DF<span class="sc">$</span>Exterior2nd<span class="sc">==</span><span class="st">"CBlock"</span>]<span class="ot">&lt;-</span><span class="st">"CemntBd"</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Exterior2nd[DF<span class="sc">$</span>Exterior2nd<span class="sc">==</span><span class="st">"Other"</span>]<span class="ot">&lt;-</span><span class="st">"plywood"</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(DF)</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">modify_df</span>(df)</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test_for_choice&lt;-modify_df(df_test_for_choice)</span></span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">&lt;-</span><span class="fu">modify_df</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</details></details></section>
<section id="remove-varibels" class="level2">
<h2 class="anchored" data-anchor-id="remove-varibels">Remove varibels</h2>
<p>In this section, I will list the variables I plan to remove or disregard. The reason for their removal is that their distributions are very skewed compared to other variables, which I deem similar in the information they provide.</p>
<p>The main reason for disregarding these variables is that I do not believe they have high predictive strength, and I need to move forward with the data cleaning process. Also, I’m not getting paid for this.</p>
<details>
<summary>
Click to expand/collapse varibel removed
</summary>
<ul>
<li><p>X3SsnPorch no real information will be removed (removed)</p></li>
<li><p>ScreenPorch no information aviable will be removed</p></li>
<li><p>Alley contain no information and will be removed</p></li>
<li><p>street contain not information and will be removed</p></li>
<li><p>Utilities contain not information and will be removed</p></li>
<li><p>Condition2 contain not information and will be removed</p></li>
<li><p>RoofMatl contain not information and will be removed will be removed</p></li>
<li><p>Heating contain not information and will be removed will be removed</p></li>
<li><p>CentralAir contain not information and will be removed will be removed</p></li>
<li><p>PoolQC contain not information and will be removed will be removed</p></li>
<li><p>MiscFeature contain not information and will be removed will be removed</p></li>
<li><p>GarageQual</p></li>
<li><p>GarageCond</p></li>
<li><p>GarageType</p></li>
<li><p>Electrical</p></li>
</ul>
<details>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>remove_varibels<span class="ot">&lt;-</span><span class="cf">function</span>(DF){</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>X3SsnPorch<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>ScreenPorch<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Alley<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Street<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Utilities<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Condition2<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>RoofMatl<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Heating<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>CentralAir<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>PoolQC<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>SaleType<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageQual<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageCond<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>GarageType<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  DF<span class="sc">$</span>Electrical<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(DF)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">remove_varibels</span>(df)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">#df_test_for_choice&lt;-remove_varibels(df_test_for_choice)</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">&lt;-</span><span class="fu">remove_varibels</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</details></details></section>
<section id="variables-after-cleanup" class="level2">
<h2 class="anchored" data-anchor-id="variables-after-cleanup">Variables After Cleanup</h2>
<p>Below, I have plotted the variables remaining after the cleanup.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data_after_clean.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(df)) {</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(df[[col]])) {</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Numeriske variabler - Lav histogram</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    n_unique <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(df[[col]]))</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes_string</span>(<span class="at">x =</span> col)) <span class="sc">+</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="fu">min</span>(n_unique, <span class="dv">30</span>), <span class="at">fill =</span> <span class="st">'skyblue'</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Histogram of'</span>, col), <span class="at">x =</span> col, <span class="at">y =</span> <span class="st">'Frequency'</span>) <span class="sc">+</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_minimal</span>()</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ikke-numeriske variabler - Lav bar plot</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes_string</span>(<span class="at">x =</span> col)) <span class="sc">+</span> </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">'orange'</span>, <span class="at">color =</span> <span class="st">'black'</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">'Bar Plot of'</span>, col), <span class="at">x =</span> col, <span class="at">y =</span> <span class="st">'Count'</span>) <span class="sc">+</span> </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">theme_minimal</span>()</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)  <span class="co"># Vis plottet</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre class="shinylive-r" data-engine="r"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 600
library(shiny)
library(ggplot2)

data_before &lt;- read.csv("https://raw.githubusercontent.com/Missing-almost-everywhere/Missing-almost-everywhere.io/main/Projects/house-prices-advanced-regression-techniqueshouse-prices-advanced-regression-techniques-data/data_after_clean.csv")

ui &lt;- fluidPage(
  titlePanel("House Prices Data Visualization"),
  sidebarLayout(
    sidebarPanel(
      selectInput("variable", "Select Variable:", choices = names(data_before))
    ),
    mainPanel(
      plotOutput("dynamicPlot")
    )
  )
)

server &lt;- function(input, output) {
  output$dynamicPlot &lt;- renderPlot({
    col &lt;- input$variable
    
    if (is.numeric(data_before[[col]])) {
      ggplot(data_before, aes(x = .data[[col]])) + 
        geom_histogram(bins = 30, fill = 'skyblue', color = 'black', alpha = 0.7) +
        labs(title = paste('Histogram of', col), x = col, y = 'Frequency') +
        theme_minimal()
    } else {
      ggplot(data_before, aes(x = .data[[col]])) + 
        geom_bar(fill = 'orange', color = 'black', alpha = 0.7) +
        labs(title = paste('Bar Plot of', col), x = col, y = 'Count') +
        theme_minimal()
    }
  })
}

shinyApp(ui = ui, server = server)</code></pre>
</section>
<section id="looking-into-cross-correlation" class="level2">
<h2 class="anchored" data-anchor-id="looking-into-cross-correlation">Looking Into Cross-Correlation</h2>
<p>Below, I have plotted the correlation matrix for the variables. Since many of these variables are categorical but have a ranking, I used Spearman correlation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">na.omit</span>(df)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.95 loaded</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>numeric_df <span class="ot">&lt;-</span> df[<span class="fu">sapply</span>(<span class="fu">na.omit</span>(df), is.numeric)]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Spearman correlation matrix</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>spearman_corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_df, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute p-values (optional)</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(numeric_df), <span class="at">type =</span> <span class="st">"spearman"</span>)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>spearman_corr <span class="ot">&lt;-</span> res<span class="sc">$</span>r    <span class="co"># Correlation coefficients</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the correlation matrix</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(spearman_corr, <span class="at">method =</span> <span class="st">"color"</span>,<span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="at">tl.srt =</span> <span class="dv">60</span>, <span class="at">insig =</span> <span class="st">"blank"</span>,<span class="at">tl.cex =</span> <span class="fl">0.5</span>,<span class="at">title =</span> <span class="st">"Spearman Correlation Plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notes on the Plot Overall, the internal correlation is a lot smaller than I thought, which is good. This should make it easier to find good predictors.</p>
<p>The third variable from the bottom is the sales price. From this, one can see which variables could be potential predictors. It seems like OverallQual could be a really good predictor.</p>
<p>However, correlation only captures linear effects, so one should be cautious about relying solely on correlation for feature selection. Imagine there was a feature with a sinusoidal curve that perfectly described the data—it would have a correlation of zero.</p>
</section>
<section id="reducing-variables-based-on-multicollinearity" class="level2">
<h2 class="anchored" data-anchor-id="reducing-variables-based-on-multicollinearity">Reducing Variables Based on Multicollinearity</h2>
<p>In this section, I will reduce some variables, as multicollinearity can pose challenges for certain models. While some partitioning-based models are less sensitive to multicollinearity, linear models can be significantly impacted. In a simple linear model with two inputs, the variance of a parameter can be expressed as:</p>
<p><span class="math display">\[\text{Var}(\beta_1) = \frac{\sigma^2}{1 - \text{cor}(x_1, x_2)}\]</span></p>
<p>This means that as the correlation between two variables increases, the variance of the estimate explodes. Consequently, certain models are sensitive to multicollinearity.</p>
<p>One approach to addressing this is to remove variables with a correlation above a certain threshold. However, determining the optimal threshold is not straightforward. For a specific model, simulations can be conducted to estimate a suitable value. In this case, I want to perform some reduction before applying any models. I have chosen a cutoff point of (|0.7|). If there is a high correlation between two variables, I will remove the one with the weaker correlation to the log of the sale price.</p>
<p>Since the variables are not numeric but do have a ranking, PCA is not an option. However, Spearman correlation can still be used.</p>
<p>For variable reduction, hierarchical clustering can be applied using the absolute value of the Spearman correlations as a distance measure. Single-linkage clustering can then be employed, with a slight reformulation of the problem. Hierarchical clustering requires a distance metric, and for this purpose, the distance between two variables based on correlation can be defined as:</p>
<p><span class="math inline">\(d(x_1, x_2) = 1 - |\text{cor}(x_1, x_2)|\)</span></p>
<p>Given the cutoff of (|0.7|) for correlation, the corresponding distance after reformulation would be:</p>
<p><span class="math inline">\(1 - 0.7 = 0.3\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code here is not optimized but it was fast to write</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>numeric_df <span class="ot">&lt;-</span> df[<span class="fu">sapply</span>(<span class="fu">na.omit</span>(df), is.numeric)]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>numeric_saleprice<span class="ot">&lt;-</span>numeric_df<span class="sc">$</span>SalePrice</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>numeric_df<span class="sc">$</span>SalePrice<span class="ot">&lt;-</span><span class="cn">NULL</span> <span class="co"># remove from dataframe</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(numeric_df), <span class="at">type =</span> <span class="st">"spearman"</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>spearman_corr <span class="ot">&lt;-</span> res<span class="sc">$</span>r    <span class="co"># Correlation coefficients</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">abs</span>(spearman_corr))</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">h =</span> <span class="fl">0.3</span>) <span class="co">#</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize dendrogram</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"Hierarchical Clustering Dendrogram"</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.3</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># Add cutoff line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce varibels</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>numeric_saleprice_corr <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(numeric_df), numeric_saleprice, <span class="at">type =</span> <span class="st">"spearman"</span>)<span class="co">#$r[, "numeric_saleprice"]</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Identify clusters with multiple variables</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>duplicates <span class="ot">&lt;-</span> <span class="fu">table</span>(clusters)[<span class="fu">table</span>(clusters) <span class="sc">&gt;</span> <span class="dv">1</span>]</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>clusters_with_duplicates <span class="ot">&lt;-</span> <span class="fu">names</span>(duplicates)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (cluster <span class="cf">in</span> clusters_with_duplicates) {</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  clusters_with_duplicates</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>  n_cluster<span class="ot">=</span><span class="fu">length</span>(<span class="fu">names</span>(clusters[clusters<span class="sc">==</span>cluster]))</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>  spear_var<span class="ot">=</span><span class="fu">rep</span>(<span class="cn">NA</span>,n_cluster)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  names_cluster<span class="ot">=</span><span class="fu">names</span>(clusters[clusters<span class="sc">==</span>cluster])</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_cluster){</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(clusters[clusters<span class="sc">==</span>cluster])[i]</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>    spear_var[i]<span class="ot">=</span><span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(numeric_df[<span class="fu">names</span>(clusters[clusters<span class="sc">==</span>cluster])[i]]),<span class="fu">log</span>(numeric_saleprice),<span class="at">type=</span><span class="st">"spearman"</span>)<span class="sc">$</span>r[<span class="dv">1</span>,<span class="dv">2</span>]</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  index_of_max <span class="ot">&lt;-</span> <span class="fu">which.max</span>(spear_var)</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  names_cluster[<span class="sc">-</span>index_of_max]</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#numeric_df[names_cluster[-index_of_max]]&lt;-NULL</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  df[names_cluster[<span class="sc">-</span>index_of_max]]<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#df_test_for_choice[names_cluster[-index_of_max]]&lt;-NULL</span></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>  df_test_preformence[names_cluster[<span class="sc">-</span>index_of_max]]<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>With the clusters found, for each cluster, the feature with the highest Spearman correlation to the log of the sale price will be chosen.<br>
As a result, there was a reduction from 61 to 41 features.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>numeric_df <span class="ot">&lt;-</span> df[<span class="fu">sapply</span>(<span class="fu">na.omit</span>(df), is.numeric)]</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>numeric_saleprice<span class="ot">&lt;-</span>numeric_df<span class="sc">$</span>SalePrice</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>numeric_df<span class="sc">$</span>SalePrice<span class="ot">&lt;-</span><span class="cn">NULL</span> <span class="co"># remove from dataframe</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(numeric_df), <span class="at">type =</span> <span class="st">"spearman"</span>)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>spearman_corr <span class="ot">&lt;-</span> res<span class="sc">$</span>r    <span class="co"># Correlation coefficients</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">abs</span>(spearman_corr))</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"single"</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">h =</span> <span class="fl">0.3</span>) <span class="co">#</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize dendrogram</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc, <span class="at">main =</span> <span class="st">"Hierarchical Clustering Dendrogram"</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.3</span>, <span class="at">col =</span> <span class="st">"red"</span>) <span class="co"># Add cutoff line</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As can be seen in the new dendrogram, the dataframe has been reduced to meet the requirements.</p>
</section>
<section id="overview-of-variables-with-the-highest-correlation-to-log-of-sale-price" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-variables-with-the-highest-correlation-to-log-of-sale-price">Overview of Variables with the Highest Correlation to Log of Sale Price</h2>
<p>Below, I have ordered the variables based on the absolute value of their Spearman correlation.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Required libraries</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the dataframe to numeric columns</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>numeric_df<span class="sc">$</span>log_saleprice<span class="ot">&lt;-</span><span class="fu">log</span>(df<span class="sc">$</span>SalePrice)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>numeric_df<span class="sc">$</span>SalePrice<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure the target variable is present</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>target_variable <span class="ot">&lt;-</span> <span class="st">"log_saleprice"</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>target_variable <span class="sc">%in%</span> <span class="fu">colnames</span>(numeric_df)) {</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Target variable not found in numeric dataframe."</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Spearman correlation matrix and p-values</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rcorr</span>(<span class="fu">as.matrix</span>(numeric_df), <span class="at">type =</span> <span class="st">"spearman"</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>spearman_corr <span class="ot">&lt;-</span> res<span class="sc">$</span>r    <span class="co"># Correlation coefficients</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract correlation with the target variable</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>target_corr <span class="ot">&lt;-</span> spearman_corr[, target_variable, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>target_corr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(target_corr)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(target_corr) <span class="ot">&lt;-</span> <span class="st">"Spearman_Correlation"</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column indicating if the correlation could be computed</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>target_corr<span class="sc">$</span>Computed <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(target_corr<span class="sc">$</span>Spearman_Correlation)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort variables by Spearman correlation in descending order</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>sorted_corr <span class="ot">&lt;-</span> target_corr[<span class="fu">order</span>(<span class="fu">abs</span>(target_corr<span class="sc">$</span>Spearman_Correlation), <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Display sorted variables with their correlation and computed status</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sorted_corr[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               Spearman_Correlation Computed
log_saleprice             1.0000000     TRUE
OverallQual               0.8087095     TRUE
GrLivArea                 0.7304531     TRUE
BsmtQual                  0.6760372     TRUE
GarageArea                0.6477811     TRUE
FullBath_total            0.6371933     TRUE
GarageFinish              0.6323531     TRUE
TotalBsmtSF               0.6023901     TRUE
YearRemodAdd              0.5688537     TRUE
HeatingQC                 0.4906598     TRUE</code></pre>
</div>
</div>
<p>Look at the Year sold the collation is really low. the spand of the years it relly lowe, this would idicate that the price do not raise a lot over time in this area. I would have expted some kind of increase to compensate for inflation.</p>
<p>Below i have recoded the Time as months since 2006, 1 being january. I also plottet logsale price as agianst the month</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>numeric_df<span class="sc">$</span>time<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(df<span class="sc">$</span>MoSold)){</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  numeric_df<span class="sc">$</span>time[i]<span class="ot">&lt;-</span>(numeric_df<span class="sc">$</span>YrSold[i]<span class="sc">-</span><span class="dv">2006</span>)<span class="sc">*</span><span class="dv">12</span><span class="sc">+</span>numeric_df<span class="sc">$</span>MoSold[i]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>yearly_means <span class="ot">&lt;-</span> numeric_df <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(time) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_value =</span> <span class="fu">mean</span>(log_saleprice))</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot residuals against time</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>numeric_df[<span class="sc">!</span><span class="fu">is.na</span>(numeric_df<span class="sc">$</span>log_saleprice),], <span class="fu">aes</span>(<span class="at">x=</span>numeric_df<span class="sc">$</span>time, <span class="at">y=</span>log_saleprice)) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># Individual data points</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> yearly_means, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> mean_value, <span class="at">color =</span> <span class="st">"Mean Sold Price"</span>), </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> yearly_means, <span class="fu">aes</span>(<span class="at">x =</span> (time), <span class="at">y =</span> mean_value),</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Value"</span>,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Data with Mean Overlay"</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="co"># caluculate mean </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>monthly_means <span class="ot">&lt;-</span> numeric_df <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MoSold) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_value =</span> <span class="fu">mean</span>(log_saleprice))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>numeric_df[<span class="sc">!</span><span class="fu">is.na</span>(numeric_df<span class="sc">$</span>log_saleprice),], <span class="fu">aes</span>(<span class="at">x=</span>numeric_df<span class="sc">$</span>MoSold, <span class="at">y=</span>log_saleprice)) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span>  <span class="co"># Individual data points</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> monthly_means, <span class="fu">aes</span>(<span class="at">x =</span> MoSold, <span class="at">y =</span> mean_value, <span class="at">color =</span> <span class="st">"Mean Sold Price"</span>), </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> monthly_means, <span class="fu">aes</span>(<span class="at">x =</span> (MoSold), <span class="at">y =</span> mean_value),</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Value"</span>,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Monthly Data with Mean Overlay"</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Overall their dont seam to be any big conettiction between pice and time. From the moth plot it clear if ther varinace of the price is dependen on the time ore if the salevolum changes letting to less spread.</p>
</section>
<section id="overallqual" class="level2">
<h2 class="anchored" data-anchor-id="overallqual">OverallQual</h2>
<p>OverallQual has high corelation with saleprice.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>SalePrice),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(OverallQual), <span class="at">y=</span><span class="fu">log</span>(SalePrice)))<span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>()<span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"OverallQual"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>log price seam linear related to overall quality.</p>
</section>
<section id="ground-lvving-area" class="level2">
<h2 class="anchored" data-anchor-id="ground-lvving-area">Ground lvving area</h2>
<p>Ground living area.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>df[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>SalePrice),], <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">factor</span>(GrLivArea), <span class="at">y=</span><span class="fu">log</span>(SalePrice)))<span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>()<span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title=</span><span class="st">"GrLivArea"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="looking-at-some-no-numeric-varibels" class="level2">
<h2 class="anchored" data-anchor-id="looking-at-some-no-numeric-varibels">Looking at some no numeric varibels</h2>
<p>Some of these varibels do not have natrual ordering, wich mean computing spearman corelation is not posibel. In that case the best option (I know) is to plot the target varibels against the cagories in the varibels, theirs differenct forms, such boxbolot ore violin plot. I have chosen violin plot since it hase more resempelens with a historgram, wich i prefere over boxplot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">"data_for_final_model.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>non_numeric_cols <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(<span class="sc">~!</span><span class="fu">is.numeric</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> non_numeric_cols) {</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes_string</span>(<span class="at">x =</span> col, <span class="at">y =</span> <span class="st">"log(SalePrice)"</span>)) <span class="sc">+</span>  </span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Tilføj mean som rødt punkt</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Violin plot for"</span>, col, <span class="st">"vs log(SalePrice)"</span>)) <span class="sc">+</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)  <span class="co"># Udskriv violin plot for hver iteration</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<pre class="shinylive-r" data-engine="r"><code>#| '!! shinylive warning !!': |
#|   shinylive does not work in self-contained HTML documents.
#|   Please set `embed-resources: false` in your metadata.
#| standalone: true
#| viewerHeight: 600
library(shiny)
library(ggplot2)
library(dplyr)

data_final &lt;- read.csv("https://raw.githubusercontent.com/Missing-almost-everywhere/Missing-almost-everywhere.io/main/Projects/house-prices-advanced-regression-techniqueshouse-prices-advanced-regression-techniques-data/data_for_final_model.csv")

ui &lt;- fluidPage(
  titlePanel("None Numerical varibels"),
  sidebarLayout(
    sidebarPanel(
      selectInput("variable", "Select Variable:", 
                  choices = names(data_final))
    ),
    mainPanel(
      plotOutput("dynamicPlot")
    )
  )
)

server &lt;- function(input, output) {
  output$dynamicPlot &lt;- renderPlot({
    col &lt;- input$variable
    
    if (is.numeric(data_final[[col]])) {
      if(col != "SalePrice") {
        ggplot(data_final, aes(x = .data[[col]], y = log(SalePrice))) +
          geom_point(alpha = 0.5) +
          labs(title = paste(col, "vs log(SalePrice)")) +
          theme_minimal()
      } else {
        ggplot(data_final, aes(x = .data[[col]])) +
          geom_histogram(bins = 30, fill = 'skyblue', color = 'black', alpha = 0.7) +
          labs(title = paste('Histogram of', col)) +
          theme_minimal()
      }
    } else {
      ggplot(data_final, aes(x = .data[[col]], y = log(SalePrice))) +
        geom_violin(fill = 'skyblue', alpha = 0.7) +
        stat_summary(fun = mean, geom = "point", color = "red", size = 3) +
        labs(title = paste(col, "vs log(SalePrice)")) +
        theme_minimal() +
        theme(axis.text.x = element_text(angle = 45, hjust = 1))
    }
  })
}

shinyApp(ui = ui, server = server)
</code></pre>
<p>So what I am looking for is something their it seam like the means i sale price is different between the factors. Neighborhood, seam like a good varibel to include, in many intances on can see that the their is not even a overlab in the observed price.</p>
<p>The roofing seam like it could have potesial</p>
</section>
</section>
<section id="models" class="level1">
<h1>Models</h1>
<p>I start by using some simple models, wheer I use some intuition and look at the residuals, then i move on to some more advance techies. Fist i am gona plot some models and look at residuals, compare to some other varibels. I like to start this way since i give me a intuitions abote the data. The models made this way have the advantage their a esay to explain. In some one could want to trade some preditiv stregnth for some explaniabillaty. I am still gona use of sample preditv strength to evaluat the models. preferabelly by corss validation</p>
<section id="base-line-mocel" class="level2">
<h2 class="anchored" data-anchor-id="base-line-mocel">Base line mocel</h2>
<p>After Plotting different models and looking the residual i found the below model. Where the saleprice pr sqft of living area is combination the Neighborhood the type of dwelling (MSSubClass)</p>
<p>wich could be good candidate if one look the residuals being drawn from af t distribusion. So more heavy tale distribution,that a normal distribution. In many ways this model seam resanbull from a intuition point of view.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot original data</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>model_baseline <span class="ot">&lt;-</span><span class="fu">lm</span>((SalePrice<span class="sc">/</span>GrLivArea) <span class="sc">~</span> TotalBsmtSF<span class="sc">*</span>MSSubClass<span class="sc">:</span>Neighborhood<span class="sc">:</span>GrLivArea , <span class="at">data =</span> df) <span class="co"># lm((SalePrice / GrLivArea) ~ TotalBsmtSF+MSSubClass+Neighborhood,data=df)</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>SalePrice,<span class="fu">log</span>(df<span class="sc">$</span>SalePrice)<span class="sc">-</span><span class="fu">log</span>(model_baseline<span class="sc">$</span>fitted.value<span class="sc">*</span>df<span class="sc">$</span>GrLivArea))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(df<span class="sc">$</span>SalePrice)<span class="sc">-</span><span class="fu">log</span>(model_baseline<span class="sc">$</span>fitted.value<span class="sc">*</span>df<span class="sc">$</span>GrLivArea),<span class="at">breaks=</span><span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The histogram almost look like a t distribution</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitdistr</span>(<span class="fu">log</span>(df<span class="sc">$</span>SalePrice)<span class="sc">-</span><span class="fu">log</span>(model_baseline<span class="sc">$</span>fitted.value<span class="sc">*</span>df<span class="sc">$</span>GrLivArea), <span class="st">"t"</span>,<span class="at">start =</span> <span class="fu">list</span>(<span class="at">m=</span><span class="fu">mean</span>(<span class="fu">log</span>(df<span class="sc">$</span>SalePrice)<span class="sc">-</span><span class="fu">log</span>(model_baseline<span class="sc">$</span>fitted.value<span class="sc">*</span>df<span class="sc">$</span>GrLivArea)),<span class="at">s=</span><span class="fu">sd</span>(<span class="fu">log</span>(df<span class="sc">$</span>SalePrice)<span class="sc">-</span><span class="fu">log</span>(model_baseline<span class="sc">$</span>fitted.value<span class="sc">*</span>df<span class="sc">$</span>GrLivArea)), <span class="at">df=</span><span class="dv">2</span>),<span class="at">lower=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.001</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        m              s              df     
  -0.009049068    0.156394619    4.526172860 
 ( 0.004804025) ( 0.005221797) ( 0.565497406)</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Dowd)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">TQQPlot</span>(<span class="fu">log</span>(df<span class="sc">$</span>SalePrice)<span class="sc">-</span><span class="fu">log</span>(model_baseline<span class="sc">$</span>fitted.value<span class="sc">*</span>df<span class="sc">$</span>GrLivArea),<span class="at">df=</span><span class="fl">4.5</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-linear-interaction-model." class="level2">
<h2 class="anchored" data-anchor-id="a-linear-interaction-model.">A linear interaction model.</h2>
<p>Belove I have fitted a interaction model where log saleprice is a interactiv funtion between The type of house, the neighborhood and the size of the dewelling+ sum effect from the size of the basement. It seam reasonbell and is somewat how i would estimate a type of house for the overall price.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>Model_second_baseline<span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(SalePrice)<span class="sc">~</span>TotalBsmtSF<span class="sc">+</span>MSSubClass<span class="sc">:</span>GrLivArea<span class="sc">:</span>Neighborhood,<span class="at">data=</span>df)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Dowd)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="fu">TQQPlot</span>(Model_second_baseline<span class="sc">$</span>residuals,<span class="at">df=</span><span class="fl">4.5</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the custom metric for CV evaluation</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>log_diff_metric_model_baseline <span class="ot">&lt;-</span> <span class="cf">function</span>(data, label) {</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  groups<span class="ot">=</span><span class="fu">unique</span>(label)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  groups_score<span class="ot">=</span><span class="fu">rep</span>(<span class="cn">NA</span>,<span class="fu">length</span>(groups))</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups)){</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    groupe_for_test<span class="ot">=</span>groups[i]</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    partion_vector_train <span class="ot">&lt;-</span> <span class="fu">which</span>(label<span class="sc">!=</span> groupe_for_test)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    partion_vector_test <span class="ot">&lt;-</span> <span class="fu">which</span>(label<span class="sc">==</span> groupe_for_test)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    train_data <span class="ot">&lt;-</span> data[partion_vector_train, ] </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> data[partion_vector_test, ] </span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fit model </span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    model_baseline <span class="ot">&lt;-</span><span class="fu">lm</span>(<span class="fu">log</span>(SalePrice)<span class="sc">~</span>TotalBsmtSF<span class="sc">+</span>MSSubClass<span class="sc">:</span>GrLivArea<span class="sc">:</span>Neighborhood,<span class="at">data=</span>train_data)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get predition </span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    predicted_SalePrice <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_baseline, <span class="at">newdata =</span> test_data) </span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get log diff</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    log_diff <span class="ot">&lt;-</span> <span class="fu">log</span>(test_data<span class="sc">$</span>SalePrice) <span class="sc">-</span> (predicted_SalePrice)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save results</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    groups_score[i]<span class="ot">&lt;-</span><span class="fu">sum</span>(log_diff<span class="sc">**</span><span class="dv">2</span>)</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sum</span>(groups_score)<span class="sc">/</span><span class="fu">length</span>(data<span class="sc">$</span>SalePrice))</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a><span class="co"># make labels</span></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>n_cv<span class="ot">=</span><span class="dv">50</span></span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">=</span><span class="fu">sample</span>(<span class="fu">rep</span>(<span class="fu">seq</span>(<span class="dv">1</span>,n_cv),<span class="fu">floor</span>(<span class="fu">length</span>(df<span class="sc">$</span>Id)<span class="sc">/</span>n_cv)))</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(df<span class="sc">$</span>Id)<span class="sc">-</span><span class="fu">floor</span>(<span class="fu">length</span>(df<span class="sc">$</span>Id)<span class="sc">/</span>n_cv)<span class="sc">*</span>n_cv<span class="sc">!=</span><span class="dv">0</span>){</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  labels<span class="ot">&lt;-</span><span class="fu">c</span>(labels,<span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(df<span class="sc">$</span>Id)<span class="sc">-</span><span class="fu">floor</span>(<span class="fu">length</span>(df<span class="sc">$</span>Id)<span class="sc">/</span>n_cv)<span class="sc">*</span>n_cv)))</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">=</span><span class="fu">sample</span>(labels)</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"RMSE of log prices"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RMSE of log prices"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">log_diff_metric_model_baseline</span>(df,labels))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.06438371</code></pre>
</div>
</div>
<p>Over all the predicative stregth look good the reisudall of the model looks more simullaro to t distribuin than a normal.</p>
</section>
</section>
<section id="advances-model" class="level1">
<h1>Advances model</h1>
<section id="lasso" class="level2">
<h2 class="anchored" data-anchor-id="lasso">Lasso</h2>
<p>In this chunck of code i fit lasso model for the dataframe, by asuming a linear model over all the vearibels in the datafram penlized by the size of beta. The Lasso solves the following</p>
<p><span class="math display">\[\underset{\beta}{argmin} ||log(Y)-\beta X||_{2}^2+\lambda||\beta||_1\]</span>.</p>
<p>“It penalizes the size of the coefficients (beta). Since the penalty is based on the <span class="math inline">\(L_1\)</span> -norm, it tends to set some coefficients to zero. This encourages sparse solutions, where only the most relevant features are retained.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>df_lasso <span class="ot">&lt;-</span> df</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>log_saleprice <span class="ot">&lt;-</span> <span class="fu">log</span>(df_lasso<span class="sc">$</span>SalePrice)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>df_lasso<span class="sc">$</span>SalePrice <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>df_lasso<span class="sc">$</span>log_saleprice <span class="ot">&lt;-</span> log_saleprice  <span class="co"># Add log_saleprice to df_lasso</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>df_lasso_id<span class="ot">&lt;-</span>df_lasso<span class="sc">$</span>Id</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>df_lasso<span class="sc">$</span>Id<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove rows with NA values</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>df_lasso <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df_lasso)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into folds</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>k, <span class="at">size =</span> <span class="fu">nrow</span>(df_lasso), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize a vector to store MSEs for each fold</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>cv_mse <span class="ot">&lt;-</span> <span class="fu">numeric</span>(k)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>best_lambda_vector <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, k)</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Split data into training and test sets</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  train_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">!=</span> i)</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(folds <span class="sc">==</span> i)</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>  train_data <span class="ot">&lt;-</span> df_lasso[train_indices, ]</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>  test_data <span class="ot">&lt;-</span> df_lasso[test_indices, ]</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create design matrices</span></span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>  X_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(log_saleprice <span class="sc">~</span> . , <span class="at">data =</span> train_data)</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>  X_test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(log_saleprice <span class="sc">~</span> . , <span class="at">data =</span> test_data)</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix column mismatch between X_train and X_test</span></span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>  common_columns <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(X_train), <span class="fu">colnames</span>(X_test))</span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>  X_test <span class="ot">&lt;-</span> X_test[, common_columns, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>  X_train <span class="ot">&lt;-</span> X_train[, common_columns, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit LASSO model with cross-validation to choose lambda</span></span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>  lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, train_data<span class="sc">$</span>log_saleprice, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>  best_lambda <span class="ot">&lt;-</span> lasso_model<span class="sc">$</span>lambda.min</span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>  best_lambda_vector[i] <span class="ot">&lt;-</span> best_lambda</span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Predict on test data</span></span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_model, <span class="at">s =</span> best_lambda, <span class="at">newx =</span> X_test)</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute MSE for this fold</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>  cv_mse[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data<span class="sc">$</span>log_saleprice <span class="sc">-</span> predictions)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Average MSE across all folds</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>mean_cv_mse <span class="ot">&lt;-</span> <span class="fu">mean</span>(cv_mse)</span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Mean Cross-Validated MSE:"</span>, mean_cv_mse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Cross-Validated MSE: 0.02097314 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit final LASSO model with the average best lambda</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>mean_best_lambda <span class="ot">&lt;-</span> <span class="fu">mean</span>(best_lambda_vector, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Calculate mean lambda</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>X_full <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(log_saleprice <span class="sc">~</span> . , <span class="at">data =</span> df_lasso)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>final_lasso_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_full, log_saleprice, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> mean_best_lambda, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Print final model coefficients</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mean_cv_mse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02097314</code></pre>
</div>
</div>
<p>As observed, the predictive strength of the model is better than the baseline model, but not by a lot in terms of predictive performance.</p>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">XGBoost</h2>
<p>XGBoost is an ensemble learning method that uses repeated decision trees, where each tree is fitted on the residuals of the previous one. Essentially, it’s a sophisticated method of partitioning the dataset.</p>
<p>This approach has gained significant popularity, so I decided to give it a try. Since XGBoost relies on tree structures for partitioning, the data must have an inherent ordering. To include categorical variables, I applied one-hot encoding to transform them into a suitable format.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the dataset</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>df_xgb <span class="ot">&lt;-</span> df</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> <span class="fu">log</span>(df_xgb<span class="sc">$</span>SalePrice)  <span class="co"># Log-transform the target variable</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>df_xgb<span class="sc">$</span>SalePrice <span class="ot">&lt;-</span> <span class="cn">NULL</span>         <span class="co"># Remove the target variable from features</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>df_xgb_Id <span class="ot">&lt;-</span> df_xgb<span class="sc">$</span>Id</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>df_xgb<span class="sc">$</span>Id <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a><span class="co"># One-hot encode categorical variables</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>df_xgb <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(df_xgb)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>df_xgb <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> df_xgb)  <span class="co"># Perform one-hot encoding and remove intercept</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DMatrix</span></span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>ddata <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> df_xgb, <span class="at">label =</span> target)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set parameters for the XGBoost model</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"reg:squarederror"</span>,  <span class="co"># Regression task</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span>,                       <span class="co"># Learning rate</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,                   <span class="co"># Maximum depth of trees</span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,                 <span class="co"># Subsampling ratio</span></span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span>           <span class="co"># Feature subsampling ratio</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 10-fold cross-validation</span></span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ddata,</span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,                    <span class="co"># Number of boosting rounds</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">nfold =</span> <span class="dv">10</span>,                       <span class="co"># Number of folds for cross-validation</span></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="st">"rmse"</span>,                 <span class="co"># Evaluation metric</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,       <span class="co"># Stop early if no improvement</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">print_every_n =</span> <span class="dv">10</span>,               <span class="co"># Print progress every 10 rounds</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-rmse:10.379960+0.002592   test-rmse:10.379961+0.026888 
Multiple eval metrics are present. Will use test_rmse for early stopping.
Will train until test_rmse hasn't improved in 10 rounds.

[11]    train-rmse:3.637180+0.001203    test-rmse:3.637569+0.017285 
[21]    train-rmse:1.286535+0.000669    test-rmse:1.287011+0.011197 
[31]    train-rmse:0.469571+0.000640    test-rmse:0.476945+0.007929 
[41]    train-rmse:0.190574+0.000775    test-rmse:0.215138+0.012590 
[51]    train-rmse:0.102444+0.000572    test-rmse:0.147398+0.018300 
[61]    train-rmse:0.075914+0.000609    test-rmse:0.132825+0.019453 
[71]    train-rmse:0.065099+0.000603    test-rmse:0.129387+0.019381 
[81]    train-rmse:0.057990+0.001078    test-rmse:0.128064+0.019680 
[91]    train-rmse:0.052257+0.001140    test-rmse:0.127166+0.019725 
[100]   train-rmse:0.047739+0.001064    test-rmse:0.126684+0.019586 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the best number of boosting rounds</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>best_nrounds <span class="ot">&lt;-</span> cv_results<span class="sc">$</span>best_iteration</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Best number of rounds:"</span>, best_nrounds, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Best number of rounds: 98 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Train final model using the best number of rounds</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>final_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> ddata,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> best_nrounds</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate final model on entire dataset (or split as desired)</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_model, ddata)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>overall_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((target <span class="sc">-</span> predictions)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"RMSE on entire dataset:"</span>, overall_rmse, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE on entire dataset: 0.05299007 </code></pre>
</div>
</div>
</section>
</section>
<section id="getting-ready-for-predition" class="level1">
<h1>Getting ready for predition</h1>
<p>Overall, it seems like the best option is the lasso model for prediction.</p>
<section id="prepration-of-test-set." class="level2">
<h2 class="anchored" data-anchor-id="prepration-of-test-set.">Prepration of test set.</h2>
<p>In this section, I analyze the features in the test set. There are some missing values, which I address using the K-Nearest Neighbors (KNN) algorithm. This method is particularly effective for handling missing values in categorical variables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"df_test_preformence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "df_test_preformence"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_test_preformence<span class="sc">$</span>MSSubClass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 20  30  45  50  60  70  75  80  90 120 150 160 180 190 
543  70   6 145 276  68   7  88  57  95   1  65   7  31 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"df"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "df"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>MSSubClass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 20  30  45  50  60  70  75  80  90 120 160 180 190 
532  67  12 148 296  60  16  78  52  86  63  10  30 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="sc">$</span>MSSubClass[df_test_preformence<span class="sc">$</span>MSSubClass<span class="sc">==</span><span class="dv">150</span>]<span class="ot">=</span><span class="dv">160</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>missing values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Housing-pricing-project_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VIM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'VIM' was built under R version 4.4.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: colorspace</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: grid</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>VIM is ready to use.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Suggestions and bug-reports can be submitted at: https://github.com/statistikat/VIM/issues</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'VIM'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:bootstrap':

    diabetes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:datasets':

    sleep</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impute missing values using KNN</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>imputed_data <span class="ot">&lt;-</span> <span class="fu">kNN</span>(df_test_preformence, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># the imputed_data ad a new colum to say what vaules is imputed i am remvoving them.</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>df_test_preformence<span class="ot">&lt;-</span>imputed_data[,<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(df_test_preformence)[<span class="dv">2</span>]]</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the updated dataframe</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(df_test_preformence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1459   54</code></pre>
</div>
</div>
<p>Their is one Plywood in test set</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">unique</span>(df<span class="sc">$</span>Exterior2nd),<span class="fu">unique</span>(df_test_preformence<span class="sc">$</span>Exterior2nd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "plywood"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df_test_preformence<span class="sc">$</span>Exterior2nd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
AsbShng AsphShn Brk Cmn BrkFace CemntBd CmentBd HdBoard ImStucc MetalSd Plywood 
     18       1      15      22       2      66     199       5     233     128 
  Stone  Stucco VinylSd Wd Sdng Wd Shng 
      1      21     511     194      43 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>Exterior2nd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
AsbShng AsphShn Brk Cmn BrkFace CemntBd CmentBd HdBoard ImStucc MetalSd plywood 
     20       3       7      25       1      58     207      10     213       1 
Plywood   Stone  Stucco VinylSd Wd Sdng Wd Shng 
    142       4      26     499     196      38 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>X_full <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(log_saleprice <span class="sc">~</span> . , <span class="at">data =</span> df_lasso)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>final_lasso_model <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_full, df_lasso<span class="sc">$</span>log_saleprice, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> mean_best_lambda, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>df_lasso_evalatio <span class="ot">&lt;-</span> df_test_preformence</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>df_lasso_evalatio_id<span class="ot">&lt;-</span>df_lasso_evalatio<span class="sc">$</span>Id</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>df_lasso_evalatio<span class="sc">$</span>Id<span class="ot">&lt;-</span><span class="cn">NULL</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create design matrix for prediction from test data</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>X_predict <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(<span class="sc">~</span>., <span class="at">data =</span> df_lasso_evalatio)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify any missing columns between X_full and the prediction data (X_predict)</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>missing_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(X_full), <span class="fu">colnames</span>(X_predict))</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add missing columns to X_predict with zero values (align columns)</span></span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>X_predict <span class="ot">&lt;-</span> <span class="fu">cbind</span>(X_predict, <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(X_predict), <span class="at">ncol =</span> <span class="fu">length</span>(missing_cols),</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, missing_cols)))</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure column order matches X_full</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>X_predict <span class="ot">&lt;-</span> X_predict[, <span class="fu">colnames</span>(X_full)]</span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict log_saleprice for the test dataset</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(final_lasso_model, <span class="at">newx =</span> X_predict)</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert log predictions to SalePrice scale (exp of log predictions)</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>SalePrice_pred <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">c</span>(predictions))</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with Id and SalePrice</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>prediction_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Id =</span> df_lasso_evalatio_id, <span class="at">SalePrice =</span> SalePrice_pred)</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Write predictions to a CSV file</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a><span class="co">#write.csv(prediction_df, "sale_prices.csv", row.names = FALSE)</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the length of SalePrice predictions</span></span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(prediction_df<span class="sc">$</span>SalePrice)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1459</code></pre>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>Overall, the score is good, and I’ve noticed that many people achieve a similar score. On the leaderboards, a score of 0.00044 can be found, which I find oddly low. Apparently, this is because the same dataset is used for another project <a href="https://github.com/JinalShah2002/House-Prices-Challenge-Solution">some Boston dataset</a>, and people are finding the corresponding test values there.</p>
<p>I achieved a score of 0.13755, which is good but might be improved by using a superlearner or performing regression on the predictive values from different models.</p>
<p>I liked it was the lasso that is chosen since i vary esay to interipted, wich i nice.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>